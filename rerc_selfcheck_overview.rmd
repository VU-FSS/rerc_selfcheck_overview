---
title: "Self-check overview"
date: "`r Sys.Date()`"
author: "Koen Leuveld"
output: pdf_document
header-includes:
   - \usepackage{booktabs}
---

<!-- 
Self Check overview
Author: Koen Leuveld

This file compiles data from from the self check of VU-FSS Research Ethics 
Review Committee into an overview document.

The data is downloaded from qualtrics by rerc_selfcheck_qualtricsdownload.R and
processed by rerc_selfcheck_analysis.R

-->


```{r, include=FALSE}
library(knitr)
library(kableExtra)

#user defined variables:
start_date <- "2023-01-01"
setwd("C:/Users/kld330/git/rerc_selfcheck_overview")
download_data <- F


##further setup (no changes needed)

#make the start date useable to the sourced scripts
#see: https://stackoverflow.com/questions/14525580/how-to-pass-command-line-arguments-when-calling-source-on-an-r-file-within-ano
commandArgs <- function(...) start_date

#Download data to update CSV files used by RERC_analysis.r
if (download_data) {
	source("rerc_selfcheck_qualtricsdownload.R") 
}

#load helper functions
source("rerc_selfcheck_analysis.r")


#clean up data
self_check_data <- 
    read_csv("data/self_check_all.csv") %>%
    fix_dates %>%
    add_column(Outcome = compute_outcome(.))%>%
    cleanup()
    
```

```{r , echo=FALSE, message = FALSE}
   
#full staff overview
self_check_data %>%
filter(Date > start_date) %>%
filter(Position == "Staff") %>%
select(Date,Name,Dept = Department,Position = Position_detailed,Project,Outcome) %>%
standard_kable(paste("Completed self checks by staff and PhD candidates 
						  since",start_date, sep=" ", collapse=NULL),
               longtable = T)  %>%
kable_styling(latex_options = "repeat_header") %>%
set_widths(c(2,2.5,1,1,4.5,1))


#student detailed summary
self_check_data %>%
filter(Date > start_date) %>%
filter(Position == "Student") %>%
table_by_period(rows = Department,
                cols = Outcome) %>%
standard_kable(paste("Number of completed checks by students by department 
						  since",start_date, sep=" ", collapse=NULL))

#staff past years
self_check_data %>%
filter(Position == "Staff") %>%
table_by_period(rows=Month,
                cols = Department,
                num_rows=12) %>%
standard_kable(caption="Number of completed checks by staff and PhD candidates in the last 12 months") %>%
row_spec(12,hline_after=TRUE)

#students past year
self_check_data %>%
filter(Position == "Student") %>%
table_by_period(rows=Month,
                cols = Department,
                num_rows=12) %>%
standard_kable(caption="Number of completed checks by master students in the last 12 months") %>%
row_spec(12,hline_after=TRUE)

```

\clearpage

```{r echo=FALSE, message = F}
plot_numbers(data = self_check_data,
             x = Month,
             group = Position,
             type = "line",
             smooth=TRUE,             
             title="Number of completed self-checks by staff and students")


self_check_data %>%
filter(Position == "Student") %>%
plot_numbers(x = Quarter,
             type="bar",
             smooth=T,
             group = Department,
             num_x = 12,
             title="Number of completed self-checks by staff per department")



```