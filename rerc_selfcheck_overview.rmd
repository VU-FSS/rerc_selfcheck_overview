---
title: "Self-check overview"
date: "`r Sys.Date()`"
author: "Koen Leuveld"
output: pdf_document
header-includes:
   - \usepackage{booktabs}
---

<!-- 
Self Check overview
Author: Koen Leuveld

This file compiles data from from the self check of VU-FSS Research Ethics 
Review Committee into an overview document.

The data is downloaded from qualtrics by rerc_selfcheck_qualtricsdownload.R and
processed by rerc_selfcheck_analysis.R

-->


```{r, include=FALSE}
library(knitr)
library(kableExtra)

#user defined variables:
start_date <- "2023-01-01"
setwd("C:/Users/kld330/git/rerc_selfcheck_overview")
download_data <- F


##further setup (no changes needed)

#make the start date useable to the sourced scripts
#see: https://stackoverflow.com/questions/14525580/how-to-pass-command-line-arguments-when-calling-source-on-an-r-file-within-ano
commandArgs <- function(...) start_date

#Download data to update CSV files used by RERC_analysis.r
if (download_data) {
	source("rerc_selfcheck_qualtricsdownload.R") 
}

#load helper functions
source("rerc_selfcheck_analysis.r")


#clean up data
self_check_data <- 
    read_csv("data/self_check_all.csv") %>%
    fix_dates %>%
    add_column(Outcome = compute_outcome(.))%>%
    cleanup() %>%
    select(Date,Name,Project,Position,Position_detailed,Department,Outcome,Month,Quarter,Year,Academic_Year)

```

```{r , echo=FALSE, message = FALSE}
#display all tables and plots
self_check_data %>%
filter(Date > start_date) %>%
filter(Position == "Staff") %>%
select(Date,Name,Dept = Department,Position = Position_detailed,Project,Outcome) %>%

kable(booktabs = T ,
		longtable=T,
		caption=paste("Completed self checks by staff and PhD candidates 
						  since",start_date, sep=" ", collapse=NULL),
		position = "h")%>%
kable_styling(latex_options = "striped") %>%
kable_styling(latex_options = "repeat_header") %>%
column_spec(1,width="2cm") %>%
column_spec(2,width="2.5cm") %>%
column_spec(3,width="1cm") %>%
column_spec(4,width="1cm") %>%
column_spec(5,width="4.5cm") %>%
column_spec(6,width="1cm") 

table_by_period(data=self_check_data,
                position="Student",            
               rows = Department,
              cols = Outcome,
              start_date = start_date) %>%
kable(booktabs = T ,
		longtable=F,
		caption=paste("Number of completed checks by students by department 
						  since",start_date, sep=" ", collapse=NULL),
		position = "h") %>%
kable_styling(latex_options = "striped") 


table_by_period(data=self_check_data,
                position="Staff",
                rows=Month,
                cols = Department,
                num_rows=12) %>%
kable(booktabs = T, 
		longtable=F,
		caption="Number of completed checks by staff and PhD candidates in the last 12 months",
		position="h") %>%
kable_styling(latex_options = "striped") %>%
row_spec(12,hline_after=TRUE)

table_by_period(data=self_check_data,
                position="Student",
                rows=Month,
                cols = Department,
                num_rows=12) %>%
kable(booktabs = T, 
		longtable=F,
		caption="Number of completed checks by master students in the last 12 months",
		position="h") %>%
kable_styling(latex_options = "striped") %>%
row_spec(12,hline_after=TRUE)

```

\clearpage

```{r echo=FALSE, message = F}
plot_numbers(data = self_check_data,
             x = Month,
             group = Position,
             type = "line",
             smooth=TRUE,             
             title="Number of completed self-checks by staff and students")


plot_numbers(data = self_check_data,
             x = Quarter,
             position="Staff",
             type="bar",
             smooth=T,
             group = Department,
             num_x = 12,
             title="Number of completed self-checks by staff per department")



```